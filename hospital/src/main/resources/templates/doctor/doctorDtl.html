<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layouts/layout1}">
<th:block layout:fragment="css">
    <style></style>
</th:block>
<head> <!--ajax를 쓸 때 반드시 필요 -->
    <meta name="_csrf" th:content="${_csrf.token}" />
    <meta name="_csrf_header" th:content="${_csrf.headerName}" />
</head>
<div layout:fragment="content">
    <section
            class="hero-wrap hero-wrap-2"
            style="background-image: url('/images/doctor/bg_1.jpg')"
            data-stellar-background-ratio="0.5"
    >
        <div class="overlay"></div>
        <div class="container">
            <div
                    class="row no-gutters slider-text align-items-center justify-content-center"
            >
                <div class="col-md-9 ftco-animate text-center">
                    <h1 class="mb-2 bread">About Us</h1>
                    <p class="breadcrumbs">
                     <span class="mr-2"
                     ><a href="index.html"
                     >Home <i class="ion-ios-arrow-forward"></i></a
                     ></span>
                        <span>About us <i class="ion-ios-arrow-forward"></i></span>
                    </p>
                </div>
            </div>
        </div>
    </section>
    <section class="ftco-section ftco-no-pt ftc-no-pb">
        <div class="container">
            <div class="row no-gutters">
                <input type="hidden" id="doctorId" th:value="${doctor.id}" />
                <div class="col-md-5 p-md-5 img img-2 mt-5 mt-md-0" th:style="'background-image: url('+${doctor.doctorImgDtoList[0].imgUrl}+')'">
                </div>
                <div class="col-md-7 wrap-about py-4 py-md-5 ftco-animate">
                    <div class="heading-section mb-5">
                        <div class="pl-md-5 ml-md-5">
                            <span class="subheading" th:text="'전공: '+ ${doctor.major}"></span>
                            <h2 class="mb-4" style="font-size: 28px" th:text="'교수명: '+${doctor.doctorNm}">
                            </h2>
                        </div>
                    </div>
                    <div class="pl-md-5 ml-md-5 mb-5">
                        <p th:text="'진료내용: '+${doctor.doctorDetail}">
                        </p>
                    </div>
                    <div class="d-md-flex justify-content-center" sec:authorize="isAuthenticated()">
                        <div class="form-group">
                            <div class="input-wrap">
                                <div class="icon">
                                    <span class="ion-md-calendar"></span>
                                </div>
                                <input
                                        type="text"
                                        class="form-control appointment_date"
                                        name="rDate"
                                        id="rDate"
                                        placeholder="Date"
                                />
                            </div>
                        </div>
                        <div class="form-group ml-md-4" sec:authorize="isAuthenticated()">
                            <div class="input-wrap">
                                <div class="icon">
                                    <span class="ion-ios-clock"></span>
                                </div>
                                <input
                                        type="text"
                                        class="form-control appointment_time"
                                        name="rTime"
                                        id="rTime"
                                        placeholder="Time"
                                />
                            </div>
                        </div>
                    </div>
                    <div class="d-md-flex justify-content-center" sec:authorize="isAuthenticated()">
                        <div class="form-group ml-md-4">
                            <!-- 예약 버튼에 onclick 이벤트 추가 -->
                            <input
                                    type="submit"
                                    value="간편 예약"
                                    class="btn btn-secondary py-3 px-4"
                                    onclick="reserve()"
                            />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>


<th:block layout:fragment="script">
    <script th:inline="javascript">
        function reserve(){
            var token = $("meta[name='_csrf']").attr("content");
            var header = $("meta[name='_csrf_header']").attr("content");

            var paramData ={
                doctorId :$("#doctorId").val(),
                rDate: $("#rDate").val(), // 쉼표 추가
                rTime: $("#rTime").val()
            }
            var param = JSON.stringify(paramData);
            $.ajax({
                url : "/reserve",
                type : "post",
                contentType : "application/json",
                data : param,
                beforeSend : function(xhr) {
                    xhr.setRequestHeader(header, token);
                },
                dataType : "json",
                cache : false,
                success : function(result, status) {
                    alert("예약이 완료되었습니다."); // 성공 메시지 수정
                },
                error : function(jqXHR, status, error) {
                    if(jqXHR.status== '401'){
                        alert('로그인 후 이용해주세요');
                        location.href='/members/login';
                    } else{
                        alert(jqXHR.responseText);
                    }
                }
            });
        }
    </script>
</th:block>
</html>
